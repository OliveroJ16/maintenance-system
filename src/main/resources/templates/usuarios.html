<div class="header">
    <div class="header-left">
        <h1 id="pageTitle">Usuarios</h1>
        <p id="pageDescription">Gestión de usuarios del sistema</p>
    </div>
    <div class="header-right">
        <div class="user-profile">
            <div class="avatar">AD</div>
            <div class="user-info">
                <h4>Admin</h4>
                <p>Administrador</p>
            </div>
        </div>
    </div>
</div>

<div class="content-area">
    <div class="section-card">
        <div class="section-header">
            <div class="section-title">
                <h2>Gestión de Usuarios</h2>
                <p>Consultar, registrar y administrar usuarios</p>
            </div>
            <button class="btn btn-primary" onclick="openUserModal()">
                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Nuevo Usuario
            </button>
        </div>

        <div class="search-bar">
            <input type="text" placeholder="Buscar usuario..." onkeyup="searchUsers(this.value)">
        </div>

        <div class="table-container">
            <table id="usersTable">
                <thead>
                <tr>
                    <th>Usuario</th>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Rol</th>
                    <th>Email</th>
                    <th>Chofer</th>
                    <th>Fecha Registro</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                <!-- Itera sobre la lista 'usuarios' del modelo -->
                <tr th:each="u : ${usuarios}">
                    <td th:text="${u.username}">admin</td>
                    <td th:text="${u.firstName}">Juan</td>
                    <td th:text="${u.lastName}">Pérez</td>
                    <td th:text="${u.role}">administrador</td>
                    <td th:text="${u.email}">juan@example.com</td>
                    <td th:text="${u.driver != null ? u.driver.nombre : '—'}">Sin chofer</td>
                    <td th:text="${#temporals.format(u.registrationDate, 'dd/MM/yyyy HH:mm')}">2025-11-12 10:00</td>
                    <td>
                        <div class="action-buttons">
                            <button class="icon-btn edit" th:onclick="'editUser(' + ${u.idUser} + ')'">
                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414
                                              a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </button>
                            <button class="icon-btn delete" th:onclick="'deleteUser(' + ${u.idUser} + ')'">
                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862
                                              a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4
                                              a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal para agregar/editar usuario -->
<div id="userModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Nuevo Usuario</h3>
            <button class="close-btn" onclick="closeUserModal()">&times;</button>
        </div>

        <!-- FORMULARIO DE REGISTRO DE USUARIO -->
        <form id="userForm" th:action="@{/usuarios}" th:object="${nuevoUsuario}" method="post" onsubmit="saveUser(event)">
            <div class="form-grid">
                <div class="form-group">
                    <label>Nombre de Usuario</label>
                    <input type="text" th:field="*{username}" required>
                </div>
                <div class="form-group">
                    <label>Contraseña</label>
                    <input type="password" th:field="*{password}" required>
                </div>
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" th:field="*{firstName}" required>
                </div>
                <div class="form-group">
                    <label>Apellido</label>
                    <input type="text" th:field="*{lastName}" required>
                </div>
                <div class="form-group">
                    <label>Rol</label>
                    <select th:field="*{role}" required>
                        <option value="">Seleccionar rol</option>
                        <option value="ADMINISTRADOR">Administrador</option>
                        <option value="SUPERVISOR">Supervisor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" th:field="*{email}" required>
                </div>
                <div class="form-group">
                    <label>Chofer Asignado</label>
                    <input type="text" th:field="*{driver}" placeholder="Opcional">
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeUserModal()">Cancelar</button>
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
        </form>
    </div>
</div>