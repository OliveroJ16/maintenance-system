<div class="header">
    <div class="header-left">
        <h1 id="pageTitle">Registrar Uso de Vehículos</h1>
        <p id="pageDescription">Actualizar kilometraje de los vehículos en operación</p>
    </div>
</div>

<div class="content-area">
    <div class="section-card">
        <div class="section-header">
            <div class="section-title">
                <h2>Vehículos Activos</h2>
                <p>Registra el kilometraje actual de cada vehículo</p>
            </div>
        </div>

        <div class="search-bar">
            <input type="text" placeholder="Buscar vehículo..." onkeyup="searchSupervisorVehicles(this.value)">
        </div>

        <div class="table-container">
            <table id="supervisorVehiclesTable">
                <thead>
                    <tr>
                        <th>Placa</th>
                        <th>Marca/Modelo</th>
                        <th>Tipo</th>
                        <th>Kilometraje Actual</th>
                        <th>Última Actualización</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="v : ${vehicles}">
                        <td>
                            <strong th:text="${v.plate}">ABC-123</strong>
                        </td>
                        <td th:text="${v.brand + ' ' + v.model}">Toyota Corolla</td>
                        <td th:text="${v.vehicleType}">SEDAN</td>
                        <td>
                            <span style="font-weight: 600; color: #6366f1; font-size: 16px;" 
                                  th:text="${#numbers.formatInteger(v.mileage, 1, 'COMMA') + ' km'}">
                                10,000 km
                            </span>
                        </td>
                        <td th:text="${v.acquisitionDate != null ? #temporals.format(v.acquisitionDate, 'dd/MM/yyyy') : '—'}">
                            01/01/2025
                        </td>
                        <td>
                            <button class="btn btn-primary" 
                                    style="padding: 8px 16px; font-size: 14px;"
                                    onclick="openRegisterUsageModal(this)"
                                    th:data-id="${v.idVehicle}"
                                    th:data-plate="${v.plate}"
                                    th:data-current-km="${v.mileage}">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline; vertical-align: middle; margin-right: 4px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                                Registrar Uso
                            </button>
                        </td>
                    </tr>
                    <tr th:if="${vehicles.isEmpty()}">
                        <td colspan="6" style="text-align: center; padding: 40px; color: #9ca3af;">
                            No hay vehículos activos disponibles
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal Registrar Uso -->
<div id="registerUsageModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Registrar Uso del Vehículo</h3>
            <button class="close-btn" onclick="closeRegisterUsageModal()">&times;</button>
        </div>

        <form id="registerUsageForm" onsubmit="saveVehicleUsage(event)">
            <input type="hidden" name="vehicleId" id="usageVehicleId">
            
            <div class="form-group">
                <label>Vehículo</label>
                <input type="text" id="usagePlate" readonly class="readonly-input">
            </div>

            <div class="form-group">
                <label>Kilometraje Actual</label>
                <input type="number" id="currentKm" readonly class="readonly-input">
            </div>

            <div class="form-group">
                <label>Nuevo Kilometraje <span style="color: #e3342f;">*</span></label>
                <input type="number" 
                       name="newMileage" 
                       id="newMileage" 
                       required 
                       min="0"
                       placeholder="Ingrese el kilometraje actual">
                <small style="color: #6b7280; display: block; margin-top: 4px;">
                    Debe ser mayor al kilometraje actual
                </small>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeRegisterUsageModal()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary">
                    Guardar Registro
                </button>
            </div>
        </form>
    </div>
</div>