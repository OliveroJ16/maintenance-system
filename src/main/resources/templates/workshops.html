<div class="header">
    <div class="header-left">
        <h1 id="pageTitle">Talleres</h1>
        <p id="pageDescription">Gestión de talleres y sus servicios</p>
    </div>
</div>

<div class="content-area">
    <div class="section-card">

        <div class="section-header">
            <div class="section-title">
                <h2>Gestión de Talleres</h2>
                <p>Registrar, actualizar y administrar talleres con sus servicios</p>
            </div>

            <button class="btn btn-primary" onclick="openWorkshopModal()">
                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                Nuevo Taller
            </button>
        </div>

        <!-- Buscador -->
        <div class="search-bar">
            <input type="text" placeholder="Buscar taller..." onkeyup="searchWorkshops(this.value)">
        </div>

        <!-- TABLA DE TALLERES -->
        <div class="table-container">
            <table id="workshopsTable">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Dirección</th>
                        <th>Teléfono</th>
                        <th>Email</th>
                        <th>Especialidad</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    <tr th:each="t : ${workshops}">
                        <td th:text="${t.workshopName}"></td>
                        <td th:text="${t.address}">—</td>
                        <td th:text="${t.phone}"></td>
                        <td th:text="${t.email}">—</td>
                        <td th:text="${t.specialty}">—</td>
                        <td>
                            <span class="status-badge" th:classappend="${t.status == 'ACTIVO'} ? 'activo' : 'inactivo'"
                                th:text="${t.status}">
                            </span>
                        </td>

                        <td>
                            <div class="action-buttons">
                                <!-- Botón Ver/Gestionar Servicios -->
                                <button class="icon-btn edit"
                                    th:attr="data-workshop-id=${t.idWorkshop}, data-workshop-name=${t.workshopName}"
                                    onclick="openServicesModal(this)" title="Gestionar servicios">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                                    </svg>
                                </button>

                                <!-- Botón Editar -->
                                <button class="icon-btn edit" th:attr="
                                    data-id=${t.idWorkshop},
                                    data-name=${t.workshopName},
                                    data-address=${t.address},
                                    data-phone=${t.phone},
                                    data-email=${t.email},
                                    data-specialty=${t.specialty},
                                    data-status=${t.status}" onclick="editWorkshop(this)">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>

                                <!-- Botón Eliminar -->
                                <button class="icon-btn delete"
                                    th:onclick="'confirmDeleteWorkshop(' + ${t.idWorkshop} + ')'">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

    <div class="section-card" th:if="${services != null && !services.isEmpty()}"
        th:attr="data-workshop-id=${services[0].workshop.idWorkshop}, data-workshop-name=${services[0].workshop.workshopName}">

        <div class="section-header">
            <div class="section-title">
                <h2>Servicios de <span th:text="${services[0].workshop.workshopName}"></span></h2>
                <p>Gestionar servicios disponibles en este taller</p>
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" onclick="window.location.href='/workshops'">
                    ← Volver a Talleres
                </button>
                <button class="btn btn-primary" onclick="openServiceModal()">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Nuevo Servicio
                </button>
            </div>
        </div>

        <!-- Buscador de servicios -->
        <div class="search-bar">
            <input type="text" placeholder="Buscar servicio..." onkeyup="searchServicesInModal(this.value)">
        </div>

        <!-- Tabla de servicios -->
        <div class="table-container">
            <table id="servicesTable">
                <thead>
                    <tr>
                        <th>Servicio</th>
                        <th>Descripción</th>
                        <th>Costo</th>
                        <th>Duración</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="s : ${services}">
                        <td><strong th:text="${s.serviceName}"></strong></td>
                        <td th:text="${s.description} ?: 'Sin descripción'"></td>
                        <td style="font-weight:600; color:#059669;"
                            th:text="'$' + ${#numbers.formatDecimal(s.cost, 1, 2)}"></td>
                        <td th:text="${s.durationMinutes != null ? s.durationMinutes + ' min' : '—'}"></td>
                        <td>
                            <span class="status-badge" th:classappend="${s.status == 'ACTIVO'} ? 'activo' : 'inactivo'"
                                th:text="${s.status}">
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="icon-btn edit" th:attr="
                                        data-id=${s.idService},
                                        data-name=${s.serviceName},
                                        data-description=${s.description},
                                        data-cost=${s.cost},
                                        data-duration=${s.durationMinutes},
                                        data-status=${s.status}" onclick="editService(this)">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                                <button class="icon-btn delete"
                                    th:onclick="'confirmDeleteService(' + ${s.idService} + ')'">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- ========================================== -->
<!-- MODAL: CREAR TALLER -->
<!-- ========================================== -->
<div id="workshopModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="workshopModalTitle">Nuevo Taller</h3>
            <button class="close-btn" onclick="closeWorkshopModal()">&times;</button>
        </div>

        <form id="workshopForm" th:action="@{/workshops}" th:object="${newWorkshop}" method="post"
            onsubmit="saveWorkshop(event)">

            <div class="form-grid">
                <div class="form-group">
                    <label>Nombre del Taller</label>
                    <input type="text" th:field="*{workshopName}" required>
                </div>

                <div class="form-group">
                    <label>Dirección</label>
                    <input type="text" th:field="*{address}">
                </div>

                <div class="form-group">
                    <label>Teléfono</label>
                    <input type="text" th:field="*{phone}" required>
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" th:field="*{email}">
                </div>

                <div class="form-group">
                    <label>Especialidad</label>
                    <input type="text" th:field="*{specialty}">
                </div>

                <div class="form-group">
                    <label>Estado</label>
                    <select th:field="*{status}" required>
                        <option value="">Seleccionar estado</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                    </select>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeWorkshopModal()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
        </form>
    </div>
</div>

<!-- ========================================== -->
<!-- MODAL: EDITAR TALLER -->
<!-- ========================================== -->
<div id="editWorkshopModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Editar Taller</h3>
            <button class="close-btn" onclick="closeEditWorkshopModal()">&times;</button>
        </div>

        <form id="editWorkshopForm" onsubmit="updateWorkshop(event)">
            <input type="hidden" name="idWorkshop">

            <div class="form-grid">
                <div class="form-group">
                    <label>Nombre del Taller</label>
                    <input type="text" name="workshopName" required>
                </div>

                <div class="form-group">
                    <label>Dirección</label>
                    <input type="text" name="address">
                </div>

                <div class="form-group">
                    <label>Teléfono</label>
                    <input type="text" name="phone" required>
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email">
                </div>

                <div class="form-group">
                    <label>Especialidad</label>
                    <input type="text" name="specialty">
                </div>

                <div class="form-group">
                    <label>Estado</label>
                    <select name="status" required>
                        <option value="">Seleccionar estado</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                    </select>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeEditWorkshopModal()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary">Actualizar</button>
            </div>
        </form>
    </div>
</div>

<!-- ========================================== -->
<!-- MODAL: CREAR SERVICIO -->
<!-- ========================================== -->
<div id="serviceModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="serviceModalTitle">Nuevo Servicio</h3>
            <button class="close-btn" onclick="closeServiceModal()">&times;</button>
        </div>
        <form id="serviceForm" th:action="@{/services}" th:object="${newService}" method="post"
            onsubmit="saveService(event)">
            <input type="hidden" name="workshopId">

            <div class="form-grid">
                <div class="form-group">
                    <label>Nombre del Servicio</label>
                    <input type="text" th:field="*{serviceName}" required placeholder="Ej: Cambio de aceite">
                </div>

                <div class="form-group" style="grid-column: span 2;">
                    <label>Descripción</label>
                    <textarea th:field="*{description}" rows="3" placeholder="Descripción detallada"></textarea>
                </div>

                <div class="form-group">
                    <label>Costo ($)</label>
                    <input type="number" th:field="*{cost}" step="0.01" min="0" required placeholder="0.00">
                </div>

                <div class="form-group">
                    <label>Duración (minutos)</label>
                    <input type="number" th:field="*{durationMinutes}" min="0" placeholder="Ej: 60">
                </div>

                <div class="form-group">
                    <label>Estado</label>
                    <select th:field="*{status}" required>
                        <option value="">Seleccionar estado</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                    </select>
                </div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeServiceModal()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary">
                    Guardar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ========================================== -->
<!-- MODAL: EDITAR SERVICIO -->
<!-- ========================================== -->
<div id="editServiceModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Editar Servicio</h3>
            <button class="close-btn" onclick="closeEditServiceModal()">&times;</button>
        </div>

        <form id="editServiceForm" onsubmit="updateService(event)">
            <input type="hidden" name="idService">

            <div class="form-grid">
                <div class="form-group">
                    <label>Nombre del Servicio</label>
                    <input type="text" name="serviceName" required>
                </div>

                <div class="form-group" style="grid-column: span 2;">
                    <label>Descripción</label>
                    <textarea name="description" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>Costo ($)</label>
                    <input type="number" name="cost" step="0.01" min="0" required>
                </div>

                <div class="form-group">
                    <label>Duración (minutos)</label>
                    <input type="number" name="durationMinutes" min="0">
                </div>

                <div class="form-group">
                    <label>Estado</label>
                    <select name="status" required>
                        <option value="">Seleccionar estado</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                    </select>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeEditServiceModal()">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary">
                    Actualizar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ========================================== -->
<!-- MODAL: GESTIONAR SERVICIOS DEL TALLER -->
<!-- ========================================== -->
<div id="servicesManagementModal" class="modal hidden">
    <div class="modal-content" style="max-width: 1200px;">
        <div class="modal-header">
            <h3 id="servicesModalTitle">Servicios del Taller</h3>
            <button class="close-btn" onclick="closeServicesManagementModal()">&times;</button>
        </div>

        <div style="padding: 20px;">
            <!-- Botón para agregar nuevo servicio -->
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="openServiceModal()">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Nuevo Servicio
                </button>
            </div>

            <!-- Buscador de servicios -->
            <div class="search-bar" style="margin-bottom: 20px;">
                <input type="text" placeholder="Buscar servicio..." onkeyup="searchServicesInManagementModal(this.value)">
            </div>

            <!-- Contenedor donde se cargará la tabla de servicios -->
            <div id="servicesManagementContent">
                <div style="text-align: center; padding: 40px;">
                    <p>Cargando servicios...</p>
                </div>
            </div>
        </div>
    </div>
</div>